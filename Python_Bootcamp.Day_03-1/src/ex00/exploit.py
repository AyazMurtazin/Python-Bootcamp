try:
    from BeautifulSoup import BeautifulSoup
except ImportError:
    from bs4 import BeautifulSoup
import os

file_dir = os.path.dirname(__file__)
file_name = os.path.join(file_dir, '../../materials/evilcorp.html')

with open(file_name, 'r') as file:
    soup = BeautifulSoup(file, 'html.parser')

soup.title.string.replace_with("Evil Corp - Stealing your money every day")
username = soup.find('span', class_='name').text
h1_tag = soup.new_tag('h1')
h1_tag.string = username + ', you are hacked!'
soup.html.body.insert(1, h1_tag)

script_text = ''' 
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
        '''

script = soup.new_tag("script")
script.string = script_text
soup.html.body.insert(1, script)

linked_text = soup.find("a")
linked_text.string = "Fsociety"
linked_text["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"

new_file_name = os.path.join(file_dir, '../../materials/evilcorp_hacked.html')

with open(new_file_name, 'w') as file:
    file.write(soup.prettify(formatter='html'))
